<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../default.css">
        <link rel="icon" 
            type="image/png" 
            href="https://ubikom.cc/favicon.png">
    </head>
    <body>
        <h1>Inbox</h1>
        <a href="send.html">Compose</a>
        <table id="messages" style="width:100%" class="inbox">
            <th style="width:10%">Date</th>
            <th style="width:70%">Subject</th>
            <th style="width:20%">From</th>
        </table>

        <script>
            var messagesTable = document.getElementById("messages");
            let token = sessionStorage.getItem('token');
            let req = new XMLHttpRequest();
            req.onload = function () {
                if (req.status == 200) {
                    let res = JSON.parse(req.responseText);

                    for(var i = 0; i < res.length; i++) {
                        var row = messagesTable.insertRow(1);
                        var dateCell = row.insertCell(0);
                        var subjectCell = row.insertCell(1);
                        var fromCell = row.insertCell(2);
                        var obj = res[i];
                        dateCell.innerHTML = obj.Date;
                        fromCell.innerHTML = obj.From;
                        subjectCell.innerHTML =  "<div class='subjectLink' id='" + obj.Uid + "' onclick='openMessage(this.id)'>" + obj.Subject + "</div>";
                    }
                } else {
                    // TODO: Process error.
                }
            }
            req.open('GET', 'https://alpha.ubikom.cc:8899/inbox', true);
            req.setRequestHeader('Authorization', 'Bearer ' + token);
            console.log('sending request');
            req.send();
            function openMessage(id) {
                location.href = "message.html?uid=" + id
            }
        </script>
    </body>
</html>